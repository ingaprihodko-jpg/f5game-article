<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F5GAME –ê–¥–º–∏–Ω–∫–∞</title>
<style>
:root { --brand-purple: #390084; --accent-pink: #ED1E79; --accent-cyan: #20BAEF; --accent-green: #2AA817; --bg-main: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); --bg-card: #ffffff; --text-primary: #212529; --border-color: #dee2e6; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg-main); padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
header { text-align: center; padding: 20px 0; border-bottom: 3px solid var(--accent-pink); margin-bottom: 30px; position: relative; }
.logo { font-size: 2rem; font-weight: 900; background: linear-gradient(45deg, var(--brand-purple), var(--accent-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
#settingsBtn { position: absolute; right: 0; top: 0; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
.control-panel { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; margin-bottom: 30px; }
input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; }
textarea { min-height: 200px; resize: vertical; }
button { padding: 12px 24px; margin: 5px; border: none; border-radius: 8px; background: var(--accent-pink); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s; }
button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(237,30,121,0.4); }
.btn-publish { background: var(--accent-green); }
.settings-panel { background: #fff3cd; border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; margin-bottom: 20px; display: none; }
.settings-panel h3 { color: #856404; margin-bottom: 15px; }
#statusMessage { margin-top: 15px; padding: 12px; border-radius: 8px; display: none; }
.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.article-item { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; background: white; }
.status-draft { border-left: 4px solid #ffc107; }
.status-published { border-left: 4px solid #28a745; }
</style>
</head>
<body>
<div class="container">
<header>
<button id="settingsBtn" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
<h1 class="logo">F5GAME –ê–î–ú–ò–ù–ö–ê</h1>
<p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è–º–∏</p>
</header>

<div id="settingsPanel" class="settings-panel">
<h3>üîê –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω (–æ–¥–∏–Ω —Ä–∞–∑)</h3>
<input type="text" id="tokenInput" placeholder="GitHub Token (ghp_...)">
<input type="text" id="ownerInput" value="ingaprihodko-jpg" readonly>
<input type="text" id="repoInput" value="f5game-article" readonly>
<button onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<p style="font-size: 0.85em; color: #856404; margin-top: 10px;">
‚ö†Ô∏è –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ
</p>
</div>

<div id="mainPanel">
<div class="control-panel">
<h2>üìù –ù–æ–≤–∞—è —Å—Ç–∞—Ç—å—è</h2>
<input type="text" id="articleTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
<textarea id="articleContent" placeholder="–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏"></textarea>
<button onclick="addArticle()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button class="btn-publish" onclick="publishToGitHub()">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
<div id="statusMessage"></div>
</div>

<div id="articlesList">
<h3>üìö –í–∞—à–∏ —Å—Ç–∞—Ç—å–∏:</h3>
<div id="list"></div>
</div>
</div>
</div>

<script>
const SETTINGS_KEY = 'f5game_github_settings_v2';
const ARTICLES_KEY = 'f5game_articles_v3';
let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
let articles = JSON.parse(localStorage.getItem(ARTICLES_KEY) || '[]');

function toggleSettings() {
  const panel = document.getElementById('settingsPanel');
  panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
}

function saveSettings() {
  const token = document.getElementById('tokenInput').value.trim();
  if (!token) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω!', 'error'); return; }
  
  settings = {
    token: token,
    owner: 'ingaprihodko-jpg',
    repo: 'f5game-article'
  };
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  showStatus('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!', 'success');
  toggleSettings();
}

function checkSettings() {
  if (!settings.token) {
    showStatus('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (‚öôÔ∏è)', 'error');
    toggleSettings();
    return false;
  }
  return true;
}

function formatText(text) {
  if (!text || text.includes('<h2')) return text;
  const lines = text.split('\n').map(l => l.trim()).filter(l => l);
  let html = '';
  lines.forEach(line => {
    if (line === line.toUpperCase() && line.length > 5 && !line.startsWith('‚Ä¢')) {
      html += `<h2 style="color:#390084;margin:25px 0 15px;">${line}</h2>`;
    } else if (line.startsWith('‚Ä¢')) {
      html += `<li style="margin-left:30px;color:#20BAEF;font-weight:600;">‚Üí ${line.substring(1)}</li>`;
    } else if (line.match(/^(–ü—Ä–∏–º–µ—Ä|–í–ê–ñ–ù–û|–ö–ï–ô–°):?\s*(.+)/i)) {
      const [, type, content] = line.match(/^(–ü—Ä–∏–º–µ—Ä|–í–ê–ñ–ù–û|–ö–ï–ô–°):?\s*(.+)/i);
      html += `<div style="background:#fff5f5;border-left:4px solid #ED1E79;padding:20px;margin:20px 0;border-radius:8px;">
        <strong style="color:#ED1E79;">${type}:</strong> ${content}
      </div>`;
    } else {
      html += `<p style="line-height:1.7;margin-bottom:15px;">${line}</p>`;
    }
  });
  return html;
}

function addArticle() {
  const title = document.getElementById('articleTitle').value.trim();
  const content = document.getElementById('articleContent').value.trim();
  if (!title || !content) { showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è!', 'error'); return; }
  
  const article = { id: Date.now(), title, content: formatText(content), status: 'draft', createdAt: new Date().toISOString() };
  articles.push(article);
  localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
  
  document.getElementById('articleTitle').value = '';
  document.getElementById('articleContent').value = '';
  showStatus('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!', 'success');
  renderList();
}

async function publishToGitHub() {
  if (!checkSettings()) return;
  
  const btn = document.querySelector('.btn-publish');
  btn.disabled = true;
  btn.textContent = 'üîÑ –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';
  
  try {
    const published = articles.filter(a => a.status === 'published');
    if (published.length === 0) throw new Error('–ù–µ—Ç —Å—Ç–∞—Ç–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "published"');
    
    const jsonData = JSON.stringify(published, null, 2);
    const content = btoa(unescape(encodeURIComponent(jsonData)));
    
    const checkRes = await fetch(`https://api.github.com/repos/${settings.owner}/${settings.repo}/contents/articles.json`, {
      headers: { 'Authorization': `token ${settings.token}` }
    });
    
    let sha = '';
    if (checkRes.ok) {
      const data = await checkRes.json();
      sha = data.sha;
    }

    const response = await fetch(`https://api.github.com/repos/${settings.owner}/${settings.repo}/contents/articles.json`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${settings.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Auto-publish: ${published.length} —Å—Ç–∞—Ç–µ–π`,
        content: content,
        branch: "main",
        sha: sha || undefined
      })
    });

    if (!response.ok) throw new Error('API –æ—à–∏–±–∫–∞: ' + response.status);
    showStatus('‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –°–∞–π—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫', 'success');
  } catch (error) {
    showStatus('‚ùå ' + error.message, 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç';
  }
}

function showStatus(msg, type) {
  const status = document.getElementById('statusMessage');
  status.textContent = msg;
  status.className = type;
  status.style.display = 'block';
  setTimeout(() => status.style.display = 'none', 5000);
}

function renderList() {
  const list = document.getElementById('list');
  if (articles.length === 0) {
    list.innerHTML = '<p style="color:#666;">–ù–µ—Ç —Å—Ç–∞—Ç–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>';
    return;
  }
  
  list.innerHTML = articles.map(a => `
    <div class="article-item status-${a.status}">
      <h4>${a.title}</h4>
      <p style="color:#666;font-size:0.9em;">–°—Ç–∞—Ç—É—Å: <strong style="color:${a.status==='published'?'green':'orange'}">${a.status}</strong></p>
      <button onclick="toggleStatus(${a.id})" style="background:${a.status==='published'?'#ffc107':'#28a745'}">
        ${a.status==='published'?'–°–¥–µ–ª–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–æ–º':'‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}
      </button>
      <button onclick="deleteArticle(${a.id})" style="background:#dc3545;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
      <button onclick="previewArticle(${a.id})" style="background:#20BAEF;">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
    </div>
  `).join('');
}

function toggleStatus(id) {
  const a = articles.find(a => a.id === id);
  if (a) {
    a.status = a.status === 'draft' ? 'published' : 'draft';
    localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
    renderList();
    showStatus(`‚úÖ –°—Ç–∞—Ç—É—Å: ${a.status}`, 'success');
  }
}

function deleteArticle(id) {
  if (confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?')) {
    articles = articles.filter(a => a.id !== id);
    localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
    renderList();
    showStatus('–£–¥–∞–ª–µ–Ω–∞', 'success');
  }
}

function previewArticle(id) {
  const a = articles.find(a => a.id === id);
  if (a) {
    const w = window.open('', '_blank', 'width=900,height=700');
    w.document.write(`
      <html><head><title>${a.title}</title></head><body style="padding:40px;font-family:system-ui;max-width:800px;margin:auto;">
        <h1>${a.title}</h1>
        <p style="color:#666;">${new Date(a.createdAt).toLocaleString('ru-RU')}</p>
        <hr>${a.content}
      </body></html>
    `);
  }
}

function init() {
  if (!settings.token) {
    showStatus('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–∫–Ω–æ–ø–∫–∞ ‚öôÔ∏è)', 'error');
    document.getElementById('settingsPanel').style.display = 'block';
  } else {
    document.getElementById('settingsPanel').style.display = 'none';
  }
  renderList();
}

init();
</script>
</body>
</html>
