<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>F5GAME –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ê–¥–º–∏–Ω–∫–∞</title>
<style>
:root {
  --brand-purple: #390084; --accent-pink: #ED1E79; --accent-cyan: #20BAEF; --accent-green: #2AA817;
  --bg-main: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  --bg-card: #ffffff; --text-primary: #212529; --border-color: #dee2e6;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg-main); padding: 20px; }
.container { max-width: 1200px; margin: 0 auto; }
header { text-align: center; padding: 20px 0; border-bottom: 3px solid var(--accent-pink); margin-bottom: 30px; position: relative; }
.logo { font-size: 2rem; font-weight: 900; background: linear-gradient(45deg, var(--brand-purple), var(--accent-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
#settingsBtn { position: absolute; right: 0; top: 0; padding: 8px 16px; background: #666; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
.control-panel { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; margin-bottom: 30px; }
input, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; }
textarea { min-height: 200px; resize: vertical; }
button { padding: 12px 24px; margin: 5px; border: none; border-radius: 8px; background: var(--accent-pink); color: white; font-weight: bold; cursor: pointer; transition: all 0.3s; }
button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(237,30,121,0.4); }
.btn-publish { background: var(--accent-green); }
.btn-publish:hover { background: #218d0f; }
#statusMessage { margin-top: 15px; padding: 12px; border-radius: 8px; display: none; }
.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
.settings-panel { background: #fff3cd; border: 2px solid #ffeaa7; border-radius: 12px; padding: 20px; margin-bottom: 20px; display: none; }
.settings-panel h3 { color: #856404; margin-bottom: 15px; }
.hidden { display: none; }
.article-item { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; background: white; }
.status-draft { border-left: 4px solid #ffc107; }
.status-published { border-left: 4px solid #28a745; }
</style>
</head>
<body>
<div class="container">
<header>
<button id="settingsBtn" onclick="toggleSettings()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
<h1 class="logo">F5GAME –ê–î–ú–ò–ù–ö–ê</h1>
<p>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—å—è–º–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –≤–µ—Ä—Å–∏—è)</p>
</header>

<!-- –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
<div id="settingsPanel" class="settings-panel">
<h3>üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–≤–≤–æ–¥–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑)</h3>
<input type="text" id="tokenInput" placeholder="GitHub Personal Access Token (ghp_...)">
<input type="text" id="ownerInput" placeholder="–í–∞—à –Ω–∏–∫ –Ω–∞ GitHub (–Ω–∞–ø—Ä–∏–º–µ—Ä: AnnaKuznetsova)">
<input type="text" id="repoInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (f5game-article)" value="f5game-article">
<button onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
<button onclick="toggleSettings()" style="background: #666;">–ó–∞–∫—Ä—ã—Ç—å</button>
<p style="font-size: 0.85em; color: #856404; margin-top: 10px;">
‚ö†Ô∏è –¢–æ–∫–µ–Ω —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—É—à—å—Ç–µ –µ–≥–æ –≤ GitHub!
</p>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
<div id="mainPanel">
<div class="control-panel">
<h2>üìù –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é</h2>
<input type="text" id="articleTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏">
<textarea id="articleContent" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –ª—é–±–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞"></textarea>
<button onclick="addArticle()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑—É</button>
<button class="btn-publish" onclick="publishToGitHub()">üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç</button>
<div id="statusMessage"></div>
</div>

<div id="articlesList">
<h3>üìö –í–∞—à–∏ —Å—Ç–∞—Ç—å–∏:</h3>
<div id="list"></div>
</div>
</div>
</div>

<script>
// ========================================
// –ù–ê–°–¢–†–û–ô–ö–ò –•–†–ê–ù–Ø–¢–°–Ø –¢–û–õ–¨–ö–û –í –ë–†–ê–£–ó–ï–†–ï
// ========================================
const SETTINGS_KEY = 'f5game_github_settings';
const ARTICLES_KEY = 'f5game_articles_v2';
let settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || '{}');
let articles = JSON.parse(localStorage.getItem(ARTICLES_KEY) || '[]');

// ========================================
// –£–ü–†–ê–í–õ–ï–ù–ò–ï –ù–ê–°–¢–†–û–ô–ö–ê–ú–ò
// ========================================
function toggleSettings() {
  const panel = document.getElementById('settingsPanel');
  const isVisible = panel.style.display === 'block';
  panel.style.display = isVisible ? 'none' : 'block';
  
  if (!isVisible) {
    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è —Ç–µ–∫—É—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    document.getElementById('tokenInput').value = settings.token || '';
    document.getElementById('ownerInput').value = settings.owner || '';
    document.getElementById('repoInput').value = settings.repo || 'f5game-article';
  }
}

function saveSettings() {
  const token = document.getElementById('tokenInput').value.trim();
  const owner = document.getElementById('ownerInput').value.trim();
  const repo = document.getElementById('repoInput').value.trim();
  
  if (!token || !owner || !repo) {
    showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
    return;
  }
  
  settings = { token, owner, repo };
  localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  
  showStatus('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ!', 'success');
  toggleSettings();
}

// ========================================
// –ü–†–û–í–ï–†–ö–ê –ü–†–ò –ó–ê–ü–£–°–ö–ï
// ========================================
function checkSettings() {
  if (!settings.token || !settings.owner) {
    showStatus('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–∫–Ω–æ–ø–∫–∞ ‚öôÔ∏è)', 'error');
    document.getElementById('settingsPanel').style.display = 'block';
    return false;
  }
  return true;
}

// ========================================
// –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –¢–ï–ö–°–¢–ê
// ========================================
function formatText(text) {
  if (!text || text.includes('<div')) return text;
  const lines = text.split('\n').map(l => l.trim()).filter(l => l);
  let html = '';
  
  lines.forEach(line => {
    if (line === line.toUpperCase() && line.length > 5 && !line.startsWith('‚Ä¢')) {
      html += `<h2 style="color:#390084;margin:25px 0 15px;">${line}</h2>`;
    } else if (line.startsWith('‚Ä¢')) {
      html += `<li style="margin-left:30px;color:#20BAEF;font-weight:600;">‚Üí ${line.substring(1)}</li>`;
    } else if (line.match(/^(–ü—Ä–∏–º–µ—Ä|–í–ê–ñ–ù–û|–ö–ï–ô–°|–®–ê–ì):?\s*(.+)/i)) {
      const [, type, content] = line.match(/^(–ü—Ä–∏–º–µ—Ä|–í–ê–ñ–ù–û|–ö–ï–ô–°|–®–ê–ì):?\s*(.+)/i);
      const colors = { '–ü—Ä–∏–º–µ—Ä': '#20BAEF', '–í–ê–ñ–ù–û': '#ED1E79', '–ö–ï–ô–°': '#390084', '–®–ê–ì': '#2AA817' };
      html += `<div style="background:#fff5f5;border-left:4px solid ${colors[type]};padding:20px;margin:20px 0;border-radius:8px;">
        <strong style="color:${colors[type]};font-size:1.1em;">${type}:</strong><br>
        <div style="margin-top:8px;">${content}</div>
      </div>`;
    } else {
      html += `<p style="line-height:1.7;margin-bottom:15px;">${line}</p>`;
    }
  });
  return html;
}

// ========================================
// –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–¢–ê–¢–¨–ò
// ========================================
function addArticle() {
  const title = document.getElementById('articleTitle').value.trim();
  const content = document.getElementById('articleContent').value.trim();
  
  if (!title || !content) {
    showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ!', 'error');
    return;
  }

  const article = {
    id: Date.now(),
    title,
    content: formatText(content),
    status: 'draft',
    createdAt: new Date().toISOString()
  };

  articles.push(article);
  localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
  
  // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
  document.getElementById('articleTitle').value = '';
  document.getElementById('articleContent').value = '';
  
  showStatus('‚úÖ –°—Ç–∞—Ç—å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!', 'success');
  renderList();
}

// ========================================
// –ü–£–ë–õ–ò–ö–ê–¶–ò–Ø –ù–ê GITHUB
// ========================================
async function publishToGitHub() {
  if (!checkSettings()) return;
  
  const btn = document.querySelector('.btn-publish');
  btn.disabled = true;
  btn.textContent = 'üîÑ –ü—É–±–ª–∏–∫–∞—Ü–∏—è...';
  
  try {
    const published = articles.filter(a => a.status === 'published');
    if (published.length === 0) {
      throw new Error('–ù–µ—Ç —Å—Ç–∞—Ç–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "published"! –°–º–µ–Ω–∏—Ç–µ —Å—Ç–∞—Ç—É—Å —É —Å—Ç–∞—Ç—å–∏');
    }

    const jsonData = JSON.stringify(published, null, 2);
    const content = btoa(unescape(encodeURIComponent(jsonData)));
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
    const checkRes = await fetch(`https://api.github.com/repos/${settings.owner}/${settings.repo}/contents/articles.json`, {
      headers: { 'Authorization': `token ${settings.token}` }
    });
    
    let sha = '';
    if (checkRes.ok) {
      const data = await checkRes.json();
      sha = data.sha;
    }

    const response = await fetch(`https://api.github.com/repos/${settings.owner}/${settings.repo}/contents/articles.json`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${settings.token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Auto-publish: ${published.length} —Å—Ç–∞—Ç–µ–π`,
        content: content,
        branch: "main",
        sha: sha || undefined
      })
    });

    if (!response.ok) throw new Error('API –æ—à–∏–±–∫–∞: ' + response.status);
    
    showStatus('‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ! –°–∞–π—Ç –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 30-60 —Å–µ–∫', 'success');
  } catch (error) {
    showStatus('‚ùå ' + error.message, 'error');
  } finally {
    btn.disabled = false;
    btn.textContent = 'üöÄ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç';
  }
}

// ========================================
// –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ü–ò–°–ö–ê
// ========================================
function renderList() {
  const list = document.getElementById('list');
  if (articles.length === 0) {
    list.innerHTML = '<p style="color:#666;">–ù–µ—Ç —Å—Ç–∞—Ç–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é!</p>';
    return;
  }
  
  list.innerHTML = articles.map(a => `
    <div class="article-item status-${a.status}">
      <h4>${a.title}</h4>
      <p style="color:#666;font-size:0.9em;">–ê–≤—Ç–æ—Ä: ${'Admin'} | –°—Ç–∞—Ç—É—Å: <strong style="color:${a.status==='published'?'green':'orange'}">${a.status}</strong></p>
      <button onclick="toggleStatus(${a.id})" style="background:${a.status==='published'?'#ffc107':'#28a745'}">
        ${a.status==='published'?'–°–¥–µ–ª–∞—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–æ–º':'–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å'}
      </button>
      <button onclick="deleteArticle(${a.id})" style="background:#dc3545;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
      <button onclick="previewArticle(${a.id})" style="background:#20BAEF;">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
    </div>
  `).join('');
}

// –°–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
function toggleStatus(id) {
  const a = articles.find(a => a.id === id);
  if (a) {
    a.status = a.status === 'draft' ? 'published' : 'draft';
    localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
    renderList();
    showStatus(`‚úÖ –°—Ç–∞—Ç—É—Å: ${a.status}`, 'success');
  }
}

// –£–¥–∞–ª–∏—Ç—å
function deleteArticle(id) {
  if (confirm('–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é?')) {
    articles = articles.filter(a => a.id !== id);
    localStorage.setItem(ARTICLES_KEY, JSON.stringify(articles));
    renderList();
    showStatus('–£–¥–∞–ª–µ–Ω–∞', 'success');
  }
}

// –ü—Ä–æ—Å–º–æ—Ç—Ä
function previewArticle(id) {
  const a = articles.find(a => a.id === id);
  if (a) {
    const w = window.open('', '_blank', 'width=900,height=700');
    w.document.write(`
      <html><head><title>${a.title}</title></head><body style="padding:40px;font-family:system-ui;">
        <h1>${a.title}</h1>
        <p style="color:#666;">–ê–≤—Ç–æ—Ä: ${'Admin'} | ${new Date(a.createdAt).toLocaleString('ru-RU')}</p>
        <hr>${a.content}
      </body></html>
    `);
  }
}

// ========================================
// –°–¢–ê–†–¢ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø
// ========================================
function init() {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (!settings.token) {
    showStatus('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ GitHub (–∫–Ω–æ–ø–∫–∞ ‚öôÔ∏è)', 'error');
    toggleSettings();
  }
  
  // –°–∫—Ä—ã–≤–∞–µ–º –ø–æ–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
  if (settings.token) {
    document.getElementById('settingsPanel').style.display = 'none';
  }
  
  renderList();
}

// –ó–∞–ø—É—Å–∫
init();
</script>
</body>
</html>
